# === Preprocessing Pipeline Config (YAML) ===
# Edit this file and pass it via:  --config /path/to/config.yaml
# CLI flags still override anything here.

# ---- Core project paths (used for outputs and non-masks stages) ----
project_dir: "/Users/carlosperez/PycharmProjects/MedSAM"
labels_dir:  "/Users/carlosperez/PycharmProjects/MedSAM/bounding_box/data/labels"
yolo_split:  "/Users/carlosperez/PycharmProjects/MedSAM/bounding_box/data/yolo_split"
yolo_aug:    "/Users/carlosperez/PycharmProjects/MedSAM/bounding_box/data/yolo_split_aug"
yolo_roi:    "/Users/carlosperez/PycharmProjects/MedSAM/bounding_box/data/yolo_split_cupROI"
viz_out:     "/Users/carlosperez/PycharmProjects/MedSAM/bounding_box/data/viz_labels"

# NOTE: When using the multi-dataset block below, the top-level images_root / disc_masks / cup_masks
# are ignored for the 'masks' stage. Theyâ€™re kept here for backward-compatibility.
images_root: "/Users/carlosperez/OneDrive_UBC/Ipek_Carlos/GlaucomaDatasets/SMDG-19/full-fundus/full-fundus"
disc_masks:  "/Users/carlosperez/OneDrive_UBC/Ipek_Carlos/GlaucomaDatasets/SMDG-19/optic-disc/optic-disc"
cup_masks:   "/Users/carlosperez/OneDrive_UBC/Ipek_Carlos/GlaucomaDatasets/SMDG-19/optic-cup/optic-cup"

# ---- Which stages to run ----
all: true
steps: null  # Use when 'all' is false, e.g., ["masks","split","augment","roi","viz"]

# ---- Small subset mode (E2E sanity check) ----
subset_n: 200
subset_seed: 43
subset_copy: false

# ---- Common flags ----
write_yaml: true
dry_run: false
verbose: false

# ---- masks_to_boxes.py defaults (applied if per-dataset keys are omitted) ----
pad_pct: 0.0
min_area_px: 25
largest_only: false
require_both: false
recursive: false
masks_extra: ""

# ---- split_yolo.py ----
val_frac: 0.15
test_frac: 0.15
seed: 1337
copy: false
patient_regex: ""   # If you need special patient grouping, set a capturing regex here
split_extra: ""

# ---- augment_yolo_ds.py ----
multiplier: 2
out_ext: ".jpg"
augment_splits: ["train","val","test"]
include_images_without_labels: true

# Tiling (grid sweep)
enable_tiling: true
tile_size: 512
tile_overlap: 0.40
min_tile_vis: 0.05
keep_empty_tiles: true
tile_from_aug: false

# Zoom crops (object-centric)
enable_zoom_crops: true
zoom_scales: [0.35, 0.5, 0.7]
zoom_per_obj: 2
zoom_on: "both"
zoom_out_size: 640
zoom_jitter: 0.05
zoom_min_vis: 0.10
zoom_from_aug: false
zoom_keep_empty: true

# Multi-scale sliding zoom sweep (covers whole image)
enable_zoom_sweep: true
zoom_sweep_scales: [0.35, 0.5, 0.7]
zoom_sweep_overlap: 0.25
zoom_sweep_min_vis: 0.10
zoom_sweep_keep_empty: true
zoom_sweep_out_size: 640
zoom_sweep_from_aug: false

augment_extra: ""

# ---- build_cup_roi_dataset.py ----
roi_pad_pct: 0.10
keep_roi_negatives: false
roi_extra: ""

# ---- viz_yolo_two_boxes.py ----
viz_sample: 12
viz_alpha: 0.25
viz_save_crops: false
viz_make_montage: false
viz_extra: ""

# ---- Multi-dataset (NEW): list as many datasets as you want ----
# Each block runs masks_to_boxes.py; results are merged into a union set (images+labels).
datasets:
  - tag: smdg19
    images_root: "/Users/carlosperez/OneDrive_UBC/Ipek_Carlos/GlaucomaDatasets/SMDG-19/full-fundus/full-fundus"
    disc_masks:  "/Users/carlosperez/OneDrive_UBC/Ipek_Carlos/GlaucomaDatasets/SMDG-19/optic-disc/optic-disc"
    cup_masks:   "/Users/carlosperez/OneDrive_UBC/Ipek_Carlos/GlaucomaDatasets/SMDG-19/optic-cup/optic-cup"
    recursive: false     # set true if images/masks are nested
    exclude_name_contains: [ "PAPILA" ]


  - tag: rimone
    images_root: "/Users/carlosperez/OneDrive_UBC/Ipek_Carlos/GlaucomaDatasets/Rim-One/Organized_Rim-One/fundus"
    disc_masks:  "/Users/carlosperez/OneDrive_UBC/Ipek_Carlos/GlaucomaDatasets/Rim-One/Organized_Rim-One/optic-disc"
    cup_masks:   "/Users/carlosperez/OneDrive_UBC/Ipek_Carlos/GlaucomaDatasets/Rim-One/Organized_Rim-One/optic-cup"
    recursive: true      # Rim-One often has nested folders; true is safest

# Where the unionized dataset (images+labels) will be assembled before splitting:
union_images_root: "/Users/carlosperez/PycharmProjects/MedSAM/bounding_box/data/_union/images"
union_labels_dir:  "/Users/carlosperez/PycharmProjects/MedSAM/bounding_box/data/_union/labels"
# === Preprocessing Pipeline Config (YAML) ===
# Edit this file and pass it via:  --config /path/to/config.yaml
# CLI flags still override anything here.

# ---- Core project paths (used for outputs and non-masks stages) ----
project_dir: "/Users/carlosperez/PycharmProjects/MedSAM"
labels_dir:  "/Users/carlosperez/PycharmProjects/MedSAM/bounding_box/data/labels"
yolo_split:  "/Users/carlosperez/PycharmProjects/MedSAM/bounding_box/data/yolo_split"
yolo_aug:    "/Users/carlosperez/PycharmProjects/MedSAM/bounding_box/data/yolo_split_aug"
yolo_roi:    "/Users/carlosperez/PycharmProjects/MedSAM/bounding_box/data/yolo_split_cupROI"
viz_out:     "/Users/carlosperez/PycharmProjects/MedSAM/bounding_box/data/viz_labels"

# NOTE: When using the multi-dataset block below, the top-level images_root / disc_masks / cup_masks
# are ignored for the 'masks' stage. Theyâ€™re kept here for backward-compatibility.
images_root: "/Users/carlosperez/OneDrive_UBC/Ipek_Carlos/GlaucomaDatasets/SMDG-19/full-fundus/full-fundus"
disc_masks:  "/Users/carlosperez/OneDrive_UBC/Ipek_Carlos/GlaucomaDatasets/SMDG-19/optic-disc/optic-disc"
cup_masks:   "/Users/carlosperez/OneDrive_UBC/Ipek_Carlos/GlaucomaDatasets/SMDG-19/optic-cup/optic-cup"

# ---- Which stages to run ----
all: true
steps: null  # Use when 'all' is false, e.g., ["masks","split","augment","roi","viz"]

# ---- Small subset mode (E2E sanity check) ----
subset_n: 50
subset_seed: 43
subset_copy: false

# ---- Common flags ----
write_yaml: true
dry_run: false
verbose: false

# ---- masks_to_boxes.py defaults (applied if per-dataset keys are omitted) ----
pad_pct: 0.0
min_area_px: 25
largest_only: false
require_both: false
recursive: false
masks_extra: ""

# ---- split_yolo.py ----
val_frac: 0.15
test_frac: 0.15
seed: 1337
copy: false
patient_regex: ""   # If you need special patient grouping, set a capturing regex here
split_extra: ""

# ---- augment_yolo_ds.py (external config) ----
aug_yaml: "/Users/carlosperez/PycharmProjects/MedSAM/bounding_box/preprocess/augment_config.yaml"
augment_splits: ["train"]   # which splits to augment; keep this here if you like

# ---- build_cup_roi_dataset.py ----
roi_pad_pct: 0.0
keep_roi_negatives: false
roi_from_aug: false
roi_extra: ""

# ---- viz_yolo_two_boxes.py ----
viz_sample: 12
viz_alpha: 0.25
viz_save_crops: false
viz_make_montage: false
viz_extra: ""

# ---- Multi-dataset (NEW): list as many datasets as you want ----
# Each block runs masks_to_boxes.py; results are merged into a union set (images+labels).
datasets:
  - tag: smdg19
    images_root: "/Users/carlosperez/OneDrive_UBC/Ipek_Carlos/GlaucomaDatasets/SMDG-19/full-fundus/full-fundus"
    disc_masks:  "/Users/carlosperez/OneDrive_UBC/Ipek_Carlos/GlaucomaDatasets/SMDG-19/optic-disc/optic-disc"
    cup_masks:   "/Users/carlosperez/OneDrive_UBC/Ipek_Carlos/GlaucomaDatasets/SMDG-19/optic-cup/optic-cup"
    recursive: false
    exclude_name_contains: ["PAPILA"]

  - tag: rimone
    images_root: "/Users/carlosperez/OneDrive_UBC/Ipek_Carlos/GlaucomaDatasets/Rim-One/Organized_Rim-One/fundus"
    disc_masks:  "/Users/carlosperez/OneDrive_UBC/Ipek_Carlos/GlaucomaDatasets/Rim-One/Organized_Rim-One/optic-disc"
    cup_masks:   "/Users/carlosperez/OneDrive_UBC/Ipek_Carlos/GlaucomaDatasets/Rim-One/Organized_Rim-One/optic-cup"
    recursive: true

# Where the unionized dataset (images+labels) will be assembled before splitting:
union_images_root: "/Users/carlosperez/PycharmProjects/MedSAM/bounding_box/data/_union/images"
union_labels_dir:  "/Users/carlosperez/PycharmProjects/MedSAM/bounding_box/data/_union/labels"

yolo_disc_only: "/Users/carlosperez/PycharmProjects/MedSAM/bounding_box/data/yolo_split_disc_only"
disc_only_from_aug_train: false         # use augmented train split for disc-only
disc_only_train_splits: ["train"]      # which splits pull from aug_root
disc_only_copy_images: false           # false = symlink (fast on HPC)
disc_only_drop_empty: false            # drop images whose labels become empty after filtering